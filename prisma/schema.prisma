generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model user {
  id         String    @id @db.Uuid
  email      String    @unique @db.VarChar(256)
  password   String?   @db.VarChar(60)
  name       String?   @db.VarChar(60)
  phone      String?
  position   String?
  active     Boolean
  restaurant String[]  @db.Uuid
  role       String[]  @db.VarChar(500)
  createdAt  DateTime  @db.Date
  updatedAt  DateTime? @db.Date
}

model restaurant {
  id                                  String                @id @db.Uuid
  externalId                          String                @unique @db.VarChar(10)
  name                                String                @db.VarChar(200)
  legalName                           String                @db.VarChar()
  active                              Boolean
  phone                               String?
  alternativePhone                    String
  email                               String
  alternativeEmail                    String
  emailBilling                        String?
  financeResponsibleName              String?
  financeResponsiblePhoneNumber       String?
  user                                String[]              @db.Uuid
  address                             String[]              @db.Uuid
  closeDoor                           Boolean               @db.Boolean
  favorite                            String[]              @db.Uuid
  weeklyOrderAmount                   Int                   @db.SmallInt
  orderValue                          Decimal               @db.Decimal(10, 2)
  companyRegistrationNumber           String                @db.VarChar(14)
  companyRegistrationNumberForBilling String                @db.VarChar(14)
  stateRegistrationNumber             String?               @db.VarChar()
  cityRegistrationNumber              String?               @db.VarChar()
  createdAt                           DateTime              @db.Date
  updatedAt                           DateTime?             @db.Date
  tax                                 Decimal               @default(4.1666) @db.Decimal(10, 6)
  paymentWay                          String                @db.VarChar(200)
  verduraKg                           Boolean?              @db.Boolean
  premium                             Boolean               @default(false) @db.Boolean
  comercialBlock                      Boolean               @default(true) @db.Boolean
  financeBlock                        Boolean               @default(false) @db.Boolean
  transactions                        transactions[]
  allowClosedSupplier                 Boolean               @default(false)
  allowMinimumOrder                   Boolean               @default(false)
  registrationReleasedNewApp          Boolean               @default(true) @db.Boolean
  categories                          String[]
  blockedBySuppliers                  String[]              @db.VarChar(10)
  appVersion                          appVersion?           @relation("RestaurantAppVersion")
  asaasCustomerId                     String?               @db.VarChar(50)
  restaurant_supplier                 restaurant_supplier[]
}

model appVersion {
  id                String     @id @default(uuid()) @db.Uuid
  externalId        String     @unique @db.VarChar(10)
  OperationalSystem String
  version           String     @db.VarChar(10)
  statusId          Int?
  createdAt         DateTime   @default(now()) @db.Timestamptz(3)
  updatedAt         DateTime   @updatedAt @db.Timestamptz(3)
  restaurant        restaurant @relation("RestaurantAppVersion", fields: [externalId], references: [externalId])
  status            status?    @relation(fields: [statusId], references: [id])
}

model Categories {
  id       String   @id @db.Uuid
  category String[]
}

model clientCount {
  id         String   @id @db.Uuid
  externalId Int      @db.SmallInt
  createdAt  DateTime @default(now()) @db.Date
}

model address {
  id                              String    @id @db.Uuid
  restaurant                      String[]  @db.Uuid
  active                          Boolean
  address                         String    @db.VarChar(200)
  neighborhood                    String    @db.VarChar(200)
  initialDeliveryTime             DateTime  @db.Time(6)
  finalDeliveryTime               DateTime  @db.Time(6)
  deliveryInformation             String    @db.VarChar(500)
  closedDoorDelivery              Boolean
  responsibleReceivingName        String?   @db.VarChar(200)
  responsibleReceivingPhoneNumber String?   @db.VarChar(50)
  zipCode                         String    @db.VarChar(10)
  deliveryReference               String    @db.VarChar(500)
  createdAt                       DateTime  @db.Date
  updatedAt                       DateTime? @db.Date
  city                            String?   @db.VarChar(200)
  complement                      String?   @db.VarChar(200)
  localNumber                     String?   @db.VarChar(25)
  localType                       String?   @db.VarChar(200)
}

model favorite {
  id           String    @id @db.Uuid
  productId    String    @db.Uuid
  restaurantId String    @db.Uuid
  obs          String?   @db.VarChar(200)
  status       Int       @default(4)
  createdAt    DateTime  @default(now()) @db.Timestamptz(3)
  updatedAt    DateTime? @updatedAt @db.Timestamptz(3)
}

model cart {
  id           String  @id @db.Uuid
  productId    String  @db.Uuid
  obs          String? @db.VarChar(200)
  amount       Decimal @db.Decimal(10, 3)
  restaurantId String  @db.Uuid
  version      Int     @default(0)
  addOrder     Int?    @default(0)

  @@unique([restaurantId, productId], name: "cart_restaurantId_productId_unique")
}

model order {
  id                  String         @id @db.VarChar(50)
  restaurantId        String         @db.VarChar(20)
  addressId           String         @db.Uuid
  orderDate           DateTime       @db.Date
  deliveryDate        DateTime       @db.Date
  orderHour           DateTime       @db.Time(6)
  paymentWay          String         @db.VarChar(50)
  referencePoint      String         @db.VarChar(200)
  initialDeliveryTime DateTime       @db.Time(6)
  finalDeliveryTime   DateTime       @db.Time(6)
  totalSupplier       Decimal        @db.Decimal(10, 2)
  totalConectar       Decimal        @db.Decimal(10, 2)
  detailing           String[]       @db.VarChar(50)
  tax                 Decimal        @db.Decimal(10, 5)
  supplierId          String         @db.VarChar(50)
  calcOrderAgain      Json           @db.Json
  orderDocument       String?        @db.VarChar(1000)
  status_id           Int            @default(4)
  status              status         @relation(fields: [status_id], references: [id])
  transactions        transactions[]
  orderInvoices       order_invoice?
}

model detailing {
  id                    String  @id @db.VarChar(50)
  orderId               String  @db.VarChar(50)
  restaurantId          String  @db.Uuid
  productId             String  @db.VarChar(50)
  orderAmount           Decimal @db.Decimal(10, 3)
  restaurantFinalAmount Decimal @db.Decimal(10, 3)
  supplierFinalAmount   Decimal @db.Decimal(10, 3)
  obs                   String  @db.VarChar(250)
  supplierPricePerUnid  Decimal @db.Decimal(10, 2)
  conectarPricePerUnid  Decimal @db.Decimal(10, 2)
  status                String  @db.VarChar(100)
  supplierFinalPrice    Decimal @db.Decimal(10, 2)
  conectarFinalPrice    Decimal @db.Decimal(10, 2)
  suppliersDetailing    Json    @db.Json
}

model confirmCode {
  id         String   @id @db.Uuid
  createdAt  DateTime @db.Date
  identifier String
  code       String
}

model premiumOrder {
  id           String   @id @db.Uuid
  Date         DateTime @db.Date
  orderText    String
  cart         Json     @db.Json
  restaurantId String   @db.Uuid
  orderId      String?  @db.VarChar(50)
}

model transactions {
  id                   Int               @id @default(autoincrement())
  restaurant_id        String            @db.Uuid
  transactions_type_id Int
  order_id             String
  payment_ways_id      Int
  value                Decimal           @db.Decimal(10, 2)
  value_paid           Decimal?          @db.Decimal(10, 2)
  payment_date         DateTime?         @db.Timestamptz(3)
  status_id            Int
  createdAt            DateTime          @default(now()) @db.Timestamptz(3)
  updatedAt            DateTime?         @updatedAt @db.Timestamptz(3)
  bolecode             bolecode[]
  order                order             @relation(fields: [order_id], references: [id])
  payment_ways         payment_ways      @relation(fields: [payment_ways_id], references: [id])
  restaurant           restaurant        @relation(fields: [restaurant_id], references: [id])
  status               status            @relation(fields: [status_id], references: [id])
  transactions_type    transactions_type @relation(fields: [transactions_type_id], references: [id])
}

model transactions_type {
  id           Int            @id @default(autoincrement())
  description  String
  createdAt    DateTime       @default(now()) @db.Timestamptz(3)
  updatedAt    DateTime?      @updatedAt @db.Timestamptz(3)
  transactions transactions[]
}

model payment_ways {
  id           Int            @id @default(autoincrement())
  description  String
  createdAt    DateTime       @default(now()) @db.Timestamptz(3)
  updatedAt    DateTime?      @updatedAt @db.Timestamptz(3)
  transactions transactions[]
}

model status {
  id            Int             @id @default(autoincrement())
  description   String
  createdAt     DateTime        @default(now()) @db.Timestamptz(3)
  updatedAt     DateTime?       @updatedAt @db.Timestamptz(3)
  bolecode      bolecode[]
  order         order[]
  order_invoice order_invoice[]
  transactions  transactions[]
  appVersion    appVersion[]
}

model bolecode {
  id                     Int          @id @default(autoincrement())
  transactions_id        Int
  public_id              String?      @db.VarChar(10)
  status_id              Int
  status_updatedAt       DateTime?    @db.Timestamptz(3)
  codebar                String?
  digitable_line         String?
  value                  Decimal      @db.Decimal(10, 2)
  transaction_gateway_id String?
  txId                   String?
  pix_code               String?
  payer_gateway_id       String?
  store_gateway_id       String?
  application_gateway_id String?
  createdAt              DateTime     @default(now()) @db.Timestamptz(3)
  updatedAt              DateTime?    @updatedAt @db.Timestamptz(3)
  bolecode_id            String?
  status                 status       @relation(fields: [status_id], references: [id])
  transactions           transactions @relation(fields: [transactions_id], references: [id])
}

model companies {
  id                           Int       @id @default(autoincrement())
  cnpj                         String    @unique
  identificador_matriz_filial  Int
  descricao_matriz_filial      String
  razao_social                 String
  nome_fantasia                String
  situacao_cadastral           Int
  descricao_situacao_cadastral String
  data_situacao_cadastral      DateTime
  motivo_situacao_cadastral    Int
  nome_cidade_exterior         String?
  codigo_natureza_juridica     Int
  data_inicio_atividade        DateTime
  cnae_fiscal                  Int
  cnae_fiscal_descricao        String
  descricao_tipo_de_logradouro String
  logradouro                   String
  numero                       String
  complemento                  String?
  bairro                       String
  cep                          String
  uf                           String
  codigo_municipio             Int
  municipio                    String
  ddd_telefone_1               String?
  ddd_telefone_2               String?
  ddd_fax                      String?
  qualificacao_do_responsavel  Int
  capital_social               Float
  porte                        Int
  descricao_porte              String
  opcao_pelo_simples           Boolean
  data_opcao_pelo_simples      DateTime?
  data_exclusao_do_simples     DateTime?
  opcao_pelo_mei               Boolean
  situacao_especial            String?
  data_situacao_especial       DateTime?
}

model order_invoice {
  id        String   @id @default(cuid()) @db.VarChar(50)
  orderId   String   @unique @db.VarChar(50)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  filePath  String[] @db.VarChar(255)
  status_id Int
  premium   Boolean  @default(false)
  status    status   @relation(fields: [status_id], references: [id])
  order     order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
}

model file_log {
  id         String    @id @db.VarChar(50)
  fileUrl    String    @db.VarChar(255)
  entity     String    @db.VarChar(100)
  entityId   String?   @db.VarChar(100)
  message    String?
  status     LogStatus @default(SUCCESS)
  httpStatus Int?
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @default(now())
}

model supplier {
  id                  String                @id @db.Uuid
  externalId          String                @unique @db.VarChar(50)
  name                String                @db.VarChar(255)
  email               String                @db.VarChar(255)
  phone               String?               @db.VarChar(50)
  asaasApiToken       String                @db.VarChar(255)
  asaasWalletId       String                @db.VarChar(255)
  createdAt           DateTime              @default(now()) @db.Timestamptz(3)
  updatedAt           DateTime              @updatedAt @db.Timestamptz(3)
  restaurant_supplier restaurant_supplier[]
}

model restaurant_supplier {
  id           String   @id @default(uuid()) @db.Uuid
  restaurantId String   @db.Uuid
  supplierId   String   @db.Uuid
  createdAt    DateTime @default(now()) @db.Timestamptz(3)
  updatedAt    DateTime @updatedAt @db.Timestamptz(3)
  asaasCustomerId       String?    @db.VarChar(50)
  restaurant restaurant @relation(fields: [restaurantId], references: [id])
  supplier   supplier   @relation(fields: [supplierId], references: [id])

  @@unique([restaurantId, supplierId])
}

enum LogStatus {
  SUCCESS
  FAIL
}
